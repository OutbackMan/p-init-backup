os:
  - linux
  - osx

language: c

dist: trusty

# linux (gcc, clang)

# macosx (gcc, clang)
# https://docs.travis-ci.com/user/reference/osx/
# https://gist.github.com/yamaya/2924292

# emscripten

matrix:
  include:
    - os: linux
	  addons:
	    apt:
		  sources:
		    - ubuntu-toolchain-r-test
          packages:
		    - gcc-4.9
	  env:
	    - MATRIX_EVAL="CC=gcc-4.9"

	- os: osx
	  osx_image: xcode8 # determines version of clang
	  env:
	    - MATRIX_EVAL="brew install gcc4.9 && CC=gcc-4.9"

	- os: linux
	  addons:
	    apt:
		  sources:
		    - ubuntu-toolchain-r-test
			- llvm-toolchain-precise-3.6
		  packages:
		    - clang-3.6
	  env:
	    - MATRIX_EVAL="CC=clang3.6"


before_install:
  - eval "${MATRIX_EVAL}"

script:
  - gcc 

compiler:
  - gcc
  - clang

addons:
  apt:
    packages:
	  - sdl2

before_install:
  - if [["${TRAVIS_OS_NAME}" == "osx"]]; then
	  brew update;
	  brew install sdl2
	  brew link 
    fi

git:
  depth: 1

branches:
  only:
    - master
	- release

notifications:
  email: false
  webhooks:
    urls:
	  - https://www.webhooks.gitter.im
	  on_success: always
	  on_failure: always

matrix:
  include:
	- compiler: gcc-5
	  addons:
	    apt:
		  # Add ppa to allow for unverified libraries
		  sources: 
		    - ubuntu-toolchain-r-test
		  packages:
		    - time
	  script:
	    - CC=/usr/bin/gcc-5 cmake .
	    - cmake --build . -- -j2
	    - ctest -j2
		 
  include:
	- os: linux
      dist: trusty
	  compiler: gcc-6
	  addons:
	    apt:
		  sources: 
		    - ubuntu-toolchain-r-test
		  packages:
		    - time
	  script: \
	    autoreconf -i && \
		cd build/ && ../configure && \
		make && \
		make check

  include:
	- os: linux
      dist: trusty
	  compiler: gcc-7
	  addons:
	    apt:
		  sources: 
		    - ubuntu-toolchain-r-test
		  packages:
		    - time
	  script: \
	    autoreconf -i && \
		cd build/ && ../configure && \
		make && \
		make check
